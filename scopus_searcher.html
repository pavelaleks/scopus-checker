<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫–æ–≤–∏–∫ –Ω–∞—É—á–Ω–æ–π –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã Scopus">
    <meta name="keywords" content="scopus, –ø–æ–∏—Å–∫, –Ω–∞—É—á–Ω–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞, –ø—É–±–ª–∏–∫–∞—Ü–∏–∏, API">
    <title>Scopus Searcher | –ü–æ–∏—Å–∫–æ–≤–∏–∫ Scopus</title>
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîç</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 300;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .search-panel {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .search-form {
            display: grid;
            grid-template-columns: 1fr 200px 200px;
            gap: 20px;
            align-items: end;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group input, .form-group select {
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #fafbfc;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .results-panel {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: none;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .results-count {
            font-size: 1.1rem;
            color: #666;
            font-weight: 500;
        }

        .export-buttons {
            display: flex;
            gap: 10px;
        }

        .export-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .export-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .copy-btn {
            background: #17a2b8;
        }

        .copy-btn:hover {
            background: #138496;
        }

        .results-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .result-item {
            border: 1px solid #e1e5e9;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            background: #fafbfc;
        }

        .result-item:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .result-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .result-authors {
            color: #666;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .result-journal {
            color: #8e44ad;
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .result-year {
            color: #e74c3c;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .result-abstract {
            color: #555;
            line-height: 1.6;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .result-doi {
            color: #3498db;
            font-size: 0.85rem;
            text-decoration: none;
        }

        .result-doi:hover {
            text-decoration: underline;
        }

        .result-link {
            color: #3498db;
            font-size: 0.85rem;
            text-decoration: none;
            display: inline-block;
            margin-top: 8px;
            padding: 5px 10px;
            background: #e3f2fd;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .result-link:hover {
            background: #bbdefb;
            text-decoration: none;
            transform: translateY(-1px);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #f5c6cb;
        }

        .error-details {
            background: #fff3cd;
            color: #856404;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 0.9rem;
            border: 1px solid #ffeaa7;
        }

        .retry-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .retry-btn:hover {
            background: #c82333;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: #dc3545;
        }

        .notification.warning {
            background: #ffc107;
            color: #212529;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.1rem;
        }

        .search-type {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .search-type label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-weight: 500;
        }

        .search-type input[type="radio"] {
            margin: 0;
        }

        .api-info {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            color: #1565c0;
        }

        .api-info strong {
            color: #0d47a1;
        }

        @media (max-width: 768px) {
            .search-form {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .results-header {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }
            
            .export-buttons {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Scopus Searcher</h1>
            <p>–ü–æ–∏—Å–∫–æ–≤–∏–∫ –Ω–∞—É—á–Ω–æ–π –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã Scopus</p>
            <div style="margin-top: 20px;">
                <a href="index.html" style="color: white; text-decoration: none; margin-right: 20px; padding: 8px 16px; background: rgba(255,255,255,0.2); border-radius: 5px;">üè† –ì–ª–∞–≤–Ω–∞—è</a>
                <a href="scopus_dashboard.html" style="color: white; text-decoration: none; margin-right: 20px; padding: 8px 16px; background: rgba(255,255,255,0.2); border-radius: 5px;">üìä –î–∞—à–±–æ—Ä–¥</a>
                <a href="settings.html" style="color: white; text-decoration: none; padding: 8px 16px; background: rgba(255,255,255,0.2); border-radius: 5px;">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
            </div>
        </div>

        <div class="search-panel">
            <div class="api-info">
                <strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± API:</strong> –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Scopus API —Å –∫–ª—é—á–æ–º –¥–ª—è –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö Scopus. 
                <br><strong>–õ–∏–º–∏—Ç—ã:</strong> –ë–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø–∞ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–º–∞–∫—Å–∏–º—É–º 25 –∑–∞ –∑–∞–ø—Ä–æ—Å).
                <br><strong>–û—à–∏–±–∫–∏:</strong> –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –æ—à–∏–±–∫–∏ 401/403, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –≤–∞—à–µ–≥–æ API –∫–ª—é—á–∞.
            </div>
            
            <form class="search-form" id="scopusForm">
                <div class="search-type">
                    <label>
                        <input type="radio" name="searchType" value="author" checked>
                        –ü–æ–∏—Å–∫ –ø–æ ID –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—è
                    </label>
                    <label>
                        <input type="radio" name="searchType" value="affiliation">
                        –ü–æ–∏—Å–∫ –ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
                    </label>
                    <label>
                        <input type="radio" name="searchType" value="keywords">
                        –ü–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
                    </label>
                </div>
                
                <div class="form-group">
                    <label for="scopusQuery">ID –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—è / –ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ / –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞</label>
                    <input type="text" id="scopusQuery" placeholder="–í–≤–µ–¥–∏—Ç–µ Scopus ID (–Ω–∞–ø—Ä–∏–º–µ—Ä: 7004212771), –Ω–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏–ª–∏ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞..." required>
                    <small style="color: #666; font-size: 0.8rem; margin-top: 5px; display: block;">
                        <strong>–ü–æ–∏—Å–∫ –ø–æ –∞–≤—Ç–æ—Ä—É:</strong> –≤–≤–µ–¥–∏—Ç–µ Scopus Author ID (–Ω–∞–ø—Ä–∏–º–µ—Ä: 7004212771)<br>
                        <strong>–ü–æ–∏—Å–∫ –ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏:</strong> –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "Moscow State University")<br>
                        <strong>–ü–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º:</strong> –≤–≤–µ–¥–∏—Ç–µ —Ç–µ—Ä–º–∏–Ω—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: "machine learning artificial intelligence")<br>
                        <strong style="color: #e74c3c;">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</strong> –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ 401, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –≤–∞—à–µ–≥–æ Scopus API –∫–ª—é—á–∞
                    </small>
                </div>
                
                <div class="form-group">
                    <label for="scopusStartYear">–ì–æ–¥ –Ω–∞—á–∞–ª–∞</label>
                    <input type="number" id="scopusStartYear" min="1900" max="2024" placeholder="2020">
                </div>
                
                <div class="form-group">
                    <label for="scopusEndYear">–ì–æ–¥ –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
                    <input type="number" id="scopusEndYear" min="1900" max="2024" placeholder="2024">
                </div>
                
                <button type="submit" class="search-btn" id="scopusSearchBtn">
                    üîç –ü–æ–∏—Å–∫ –≤ Scopus
                </button>
            </form>
        </div>

        <div class="results-panel" id="resultsPanel">
            <div class="results-header">
                <div class="results-count" id="resultsCount"></div>
                <div class="export-buttons">
                    <button class="export-btn" id="downloadTxtBtn">
                        üì• TXT
                    </button>
                    <button class="export-btn" id="downloadApaBtn">
                        üìÑ APA
                    </button>
                    <button class="export-btn" id="downloadGostBtn">
                        üìã –ì–û–°–¢
                    </button>
                    <button class="export-btn" id="downloadJsonBtn">
                        üìä JSON
                    </button>
                    <button class="export-btn" id="downloadExcelBtn">
                        üìà Excel
                    </button>
                    <button class="export-btn copy-btn" id="copyBtn">
                        üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                    <button class="export-btn" id="clearCacheBtn" style="background: #dc3545;">
                        üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à
                    </button>
                </div>
            </div>
            <div class="results-list" id="resultsList"></div>
        </div>
    </div>

    <script>
        class ScopusSearcher {
            constructor() {
                this.results = [];
                this.scopusApiKey = '326d1b40932b12ea6d7413dfd2db507a';
                this.init();
            }

            init() {
                this.initForm();
                this.initExportButtons();
                this.loadCachedData();
            }

            initForm() {
                const scopusForm = document.getElementById('scopusForm');
                scopusForm.addEventListener('submit', (e) => this.handleScopusSearch(e));
            }

            initExportButtons() {
                const downloadTxtBtn = document.getElementById('downloadTxtBtn');
                const downloadApaBtn = document.getElementById('downloadApaBtn');
                const downloadGostBtn = document.getElementById('downloadGostBtn');
                const downloadJsonBtn = document.getElementById('downloadJsonBtn');
                const downloadExcelBtn = document.getElementById('downloadExcelBtn');
                const copyBtn = document.getElementById('copyBtn');
                const clearCacheBtn = document.getElementById('clearCacheBtn');

                downloadTxtBtn.addEventListener('click', () => this.downloadResults('txt'));
                downloadApaBtn.addEventListener('click', () => this.downloadResults('apa'));
                downloadGostBtn.addEventListener('click', () => this.downloadResults('gost'));
                downloadJsonBtn.addEventListener('click', () => this.downloadResults('json'));
                downloadExcelBtn.addEventListener('click', () => this.downloadResults('excel'));
                copyBtn.addEventListener('click', () => this.copyResults());
                clearCacheBtn.addEventListener('click', () => this.clearCache());
            }

            async handleScopusSearch(e) {
                e.preventDefault();
                
                const query = document.getElementById('scopusQuery').value.trim();
                const searchType = document.querySelector('input[name="searchType"]:checked').value;
                const startYear = document.getElementById('scopusStartYear').value;
                const endYear = document.getElementById('scopusEndYear').value;

                if (!query) {
                    this.showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ ID –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—è, –Ω–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏–ª–∏ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞', 'warning');
                    return;
                }

                this.showLoading();
                
                try {
                    // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∏–º API –∫–ª—é—á
                    await this.testScopusApiKey();
                    
                    const results = await this.searchScopus(query, searchType, startYear, endYear);
                    this.displayResults(results);
                    this.showNotification(`–ù–∞–π–¥–µ–Ω–æ ${results.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤`, 'success');
                } catch (error) {
                    this.handleApiError(error, 'handleScopusSearch');
                }
            }

            async testScopusApiKey() {
                // –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç API –∫–ª—é—á–∞ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏
                const testUrl = 'https://api.elsevier.com/content/search/scopus?query=test&count=1&view=MINIMAL';
                
                try {
                    const response = await fetch(testUrl, {
                        headers: {
                            'X-ELS-APIKey': this.scopusApiKey,
                            'Accept': 'application/json'
                        }
                    });
                    
                    if (response.status === 401) {
                        throw new Error('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Scopus API. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:\n' +
                            '1. –ù–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á\n' +
                            '2. API –∫–ª—é—á –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω\n' +
                            '3. –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤\n' +
                            '4. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞');
                    } else if (response.status === 403) {
                        throw new Error('API –∫–ª—é—á Scopus –Ω–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–æ–∏—Å–∫—É. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:\n' +
                            '1. –ü–æ–¥–ø–∏—Å–∫—É –Ω–∞ Scopus API\n' +
                            '2. –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –≤ –≤–∞—à–µ–º –∞–∫–∫–∞—É–Ω—Ç–µ\n' +
                            '3. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ IP –∞–¥—Ä–µ—Å—É');
                    } else if (response.status === 400) {
                        console.log('API –∫–ª—é—á —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –∑–∞–ø—Ä–æ—Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞)');
                        return; // –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
                    } else if (response.status === 200) {
                        console.log('API –∫–ª—é—á —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
                        return;
                    }
                } catch (error) {
                    if (error.message.includes('401') || error.message.includes('403')) {
                        throw error;
                    }
                    console.log('API –∫–ª—é—á —Ç–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω:', error.message);
                }
            }

            async searchScopus(query, searchType, startYear, endYear) {
                // –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
                let searchQuery = '';
                
                if (searchType === 'author') {
                    // –ü–æ–∏—Å–∫ –ø–æ ID –∞–≤—Ç–æ—Ä–∞ Scopus
                    searchQuery = `AU-ID(${query})`;
                } else if (searchType === 'affiliation') {
                    // –ü–æ–∏—Å–∫ –ø–æ –∞—Ñ—Ñ–∏–ª–∏–∞—Ü–∏–∏
                    searchQuery = `AFFIL("${query}")`;
                } else if (searchType === 'keywords') {
                    // –ü–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
                    searchQuery = `TITLE-ABS-KEY("${query}")`;
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∏–ª—å—Ç—Ä –ø–æ –≥–æ–¥–∞–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω—ã
                if (startYear && endYear) {
                    searchQuery += ` AND PUBYEAR >= ${startYear} AND PUBYEAR <= ${endYear}`;
                } else if (startYear) {
                    searchQuery += ` AND PUBYEAR >= ${startYear}`;
                } else if (endYear) {
                    searchQuery += ` AND PUBYEAR <= ${endYear}`;
                }

                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑–æ–≤—ã–π view –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –æ—à–∏–±–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                const baseUrl = 'https://api.elsevier.com/content/search/scopus';
                const params = new URLSearchParams({
                    'query': searchQuery,
                    'count': '25', // –£–º–µ–Ω—å—à–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–ª—è –±–∞–∑–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è
                    'sort': 'pubyear',
                    'view': 'STANDARD'
                });
                
                const url = `${baseUrl}?${params.toString()}`;
                
                try {
                    console.log('Scopus search URL:', url);
                    console.log('Search query:', searchQuery);
                    
                    const response = await fetch(url, {
                        method: 'GET',
                        headers: {
                            'X-ELS-APIKey': this.scopusApiKey,
                            'Accept': 'application/json'
                        }
                    });
                    
                    console.log('Response status:', response.status);
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error('Scopus API Error Response:', errorText);
                        
                        // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ 400 - –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç, –ø–æ–ø—Ä–æ–±—É–µ–º —Å –º–µ–Ω—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º
                        if (response.status === 400 && errorText.includes('maximum number allowed')) {
                            console.log('–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç, –ø—Ä–æ–±—É–µ–º —Å –º–µ–Ω—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤...');
                            return await this.searchScopusWithLimit(query, searchType, startYear, endYear, 10);
                        }
                        
                        // –ü–æ–ø—Ä–æ–±—É–µ–º —Å –µ—â–µ –±–æ–ª–µ–µ –±–∞–∑–æ–≤—ã–º view
                        if (response.status === 401) {
                            return await this.searchScopusBasic(query, searchType, startYear, endYear);
                        }
                        
                        throw new Error(`Scopus API error: ${response.status} - ${errorText}`);
                    }
                    
                    const data = await response.json();
                    console.log('Scopus API Response:', data);
                    
                    if (!data['search-results']) {
                        throw new Error('–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ—Ç Scopus API');
                    }
                    
                    return this.formatScopusResults(data['search-results'].entry || []);
                } catch (error) {
                    console.error('Scopus search error:', error);
                    
                    // –ï—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–ø—Ä–æ–±—É–µ–º –±–∞–∑–æ–≤—ã–π
                    if (error.message.includes('401')) {
                        try {
                            return await this.searchScopusBasic(query, searchType, startYear, endYear);
                        } catch (altError) {
                            throw new Error(`–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –≤ Scopus: ${error.message}. –ë–∞–∑–æ–≤—ã–π –º–µ—Ç–æ–¥ —Ç–∞–∫–∂–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª: ${altError.message}`);
                        }
                    }
                    
                    throw new Error(`–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –≤ Scopus: ${error.message}`);
                }
            }

            async searchScopusWithLimit(query, searchType, startYear, endYear, limit = 10) {
                // –ü–æ–∏—Å–∫ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                let searchQuery = '';
                
                if (searchType === 'author') {
                    searchQuery = `AU-ID(${query})`;
                } else if (searchType === 'affiliation') {
                    searchQuery = `AFFIL("${query}")`;
                } else if (searchType === 'keywords') {
                    searchQuery = `TITLE-ABS-KEY("${query}")`;
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∏–ª—å—Ç—Ä –ø–æ –≥–æ–¥–∞–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω—ã
                if (startYear && endYear) {
                    searchQuery += ` AND PUBYEAR >= ${startYear} AND PUBYEAR <= ${endYear}`;
                } else if (startYear) {
                    searchQuery += ` AND PUBYEAR >= ${startYear}`;
                } else if (endYear) {
                    searchQuery += ` AND PUBYEAR <= ${endYear}`;
                }

                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π view –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
                const url = `https://api.elsevier.com/content/search/scopus?query=${encodeURIComponent(searchQuery)}&count=${limit}&view=MINIMAL&sort=pubyear`;
                
                console.log('Trying Scopus search with limit:', url);
                
                const response = await fetch(url, {
                    headers: {
                        'X-ELS-APIKey': this.scopusApiKey,
                        'Accept': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Scopus API Error with limit:', errorText);
                    
                    // –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –æ—à–∏–±–∫–∞, –ø–æ–ø—Ä–æ–±—É–µ–º —Å –µ—â–µ –º–µ–Ω—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º
                    if (response.status === 400 && limit > 5) {
                        console.log('–í—Å–µ –µ—â–µ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç, –ø—Ä–æ–±—É–µ–º —Å 5 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏...');
                        return await this.searchScopusWithLimit(query, searchType, startYear, endYear, 5);
                    }
                    
                    throw new Error(`Scopus API error with limit: ${response.status} - ${errorText}`);
                }
                
                const data = await response.json();
                console.log('Scopus API Response with limit:', data);
                
                if (!data['search-results']) {
                    throw new Error('–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ—Ç Scopus API');
                }
                
                return this.formatScopusResults(data['search-results'].entry || []);
            }

            async searchScopusBasic(query, searchType, startYear, endYear) {
                // –ë–∞–∑–æ–≤—ã–π –º–µ—Ç–æ–¥ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞
                let searchQuery = '';
                
                if (searchType === 'author') {
                    searchQuery = `AU-ID(${query})`;
                } else if (searchType === 'affiliation') {
                    searchQuery = `AFFIL(${query})`;
                } else if (searchType === 'keywords') {
                    searchQuery = `TITLE-ABS-KEY(${query})`;
                }
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π view –¥–ª—è –±–∞–∑–æ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º
                const url = `https://api.elsevier.com/content/search/scopus?query=${encodeURIComponent(searchQuery)}&count=10&view=MINIMAL`;
                
                console.log('Trying basic Scopus search:', url);
                
                const response = await fetch(url, {
                    headers: {
                        'X-ELS-APIKey': this.scopusApiKey,
                        'Accept': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Basic Scopus API Error:', errorText);
                    throw new Error(`Basic Scopus API error: ${response.status} - ${errorText}`);
                }
                
                const data = await response.json();
                return this.formatScopusResults(data['search-results']?.entry || []);
            }

            formatScopusResults(entries) {
                return entries.map(entry => ({
                    title: entry['dc:title'] || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è',
                    authors: this.formatScopusAuthors(entry.author || []),
                    journal: entry['prism:publicationName'] || '–ñ—É—Ä–Ω–∞–ª –Ω–µ —É–∫–∞–∑–∞–Ω',
                    year: entry['prism:coverDate']?.substring(0, 4) || '–ì–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω',
                    abstract: entry['dc:description'] || '–ê–Ω–Ω–æ—Ç–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞',
                    doi: entry['prism:doi'] || entry['dc:identifier'] || '',
                    url: entry.link?.find(l => l['@ref'] === 'scopus')?.['@href'] || '',
                    volume: entry['prism:volume'] || '',
                    issue: entry['prism:issueIdentifier'] || '',
                    pages: entry['prism:pageRange'] || '',
                    citations: entry['citedby-count'] || 0,
                    source: 'scopus'
                }));
            }

            formatScopusAuthors(authors) {
                if (!authors || authors.length === 0) return '–ê–≤—Ç–æ—Ä—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã';
                
                return authors.map(author => {
                    const givenName = author['given-name'] || '';
                    const surname = author.surname || '';
                    return `${surname}, ${givenName}`;
                }).join(' | ');
            }

            displayResults(results) {
                this.results = results;
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à
                this.saveToCache('scopus_search_results', results);
                
                const resultsPanel = document.getElementById('resultsPanel');
                const resultsList = document.getElementById('resultsList');
                const resultsCount = document.getElementById('resultsCount');

                resultsPanel.style.display = 'block';
                resultsCount.textContent = `–ù–∞–π–¥–µ–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: ${results.length}`;

                if (results.length === 0) {
                    resultsList.innerHTML = '<div class="no-results">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞.</div>';
                    return;
                }

                resultsList.innerHTML = results.map((work, index) => this.formatResult(work, index + 1)).join('');
            }

            formatResult(work, index) {
                const title = work.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
                const authors = work.authors || '–ê–≤—Ç–æ—Ä—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã';
                const journal = work.journal || '–ñ—É—Ä–Ω–∞–ª –Ω–µ —É–∫–∞–∑–∞–Ω';
                const year = work.year || '–ì–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω';
                const abstract = work.abstract || '–ê–Ω–Ω–æ—Ç–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞';
                const doi = work.doi || '';
                const linkUrl = work.url || '#';
                const citations = work.citations || 0;

                return `
                    <div class="result-item">
                        <div class="result-title">${title}</div>
                        <div class="result-authors">${authors}</div>
                        <div class="result-journal">${journal}</div>
                        <div class="result-year">–ì–æ–¥: ${year} | –¶–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ${citations}</div>
                        <div class="result-abstract">${abstract}</div>
                        <div class="result-doi">DOI: ${doi}</div>
                        <a href="${linkUrl}" target="_blank" class="result-link">
                            üîó –ü–µ—Ä–µ–π—Ç–∏ –∫ —Å—Ç–∞—Ç—å–µ –≤ Scopus
                        </a>
                    </div>
                `;
            }

            showLoading() {
                const resultsPanel = document.getElementById('resultsPanel');
                const resultsList = document.getElementById('resultsList');
                
                resultsPanel.style.display = 'block';
                resultsList.innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                        <div>–ü–æ–∏—Å–∫ –≤ Scopus...</div>
                    </div>
                `;
            }

            showError(message, details = null, showRetry = false) {
                const resultsPanel = document.getElementById('resultsPanel');
                const resultsList = document.getElementById('resultsList');
                
                resultsPanel.style.display = 'block';
                let errorHtml = `<div class="error">${message}`;
                
                if (details) {
                    errorHtml += `<div class="error-details">${details}</div>`;
                }
                
                if (showRetry) {
                    errorHtml += `<button class="retry-btn" onclick="searcher.retryLastSearch()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–∏—Å–∫</button>`;
                }
                
                errorHtml += '</div>';
                resultsList.innerHTML = errorHtml;
            }

            showNotification(message, type = 'success') {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => notification.classList.add('show'), 100);
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => document.body.removeChild(notification), 300);
                }, 3000);
            }

            retryLastSearch() {
                const searchBtn = document.getElementById('scopusSearchBtn');
                searchBtn.click();
            }

            handleApiError(error, context = '') {
                console.error(`API Error in ${context}:`, error);
                
                let userMessage = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ Scopus API';
                let details = '';
                
                if (error.message.includes('401')) {
                    userMessage = '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Scopus API';
                    details = '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å API –∫–ª—é—á–∞ –∏ –µ–≥–æ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞';
                } else if (error.message.includes('403')) {
                    userMessage = '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω';
                    details = 'API –∫–ª—é—á –Ω–µ –∏–º–µ–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞';
                } else if (error.message.includes('429')) {
                    userMessage = '–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤';
                    details = '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä—É–≥–æ–π API –∫–ª—é—á';
                } else if (error.message.includes('500')) {
                    userMessage = '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ Scopus';
                    details = '–í—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ';
                } else if (error.message.includes('NetworkError') || error.message.includes('fetch')) {
                    userMessage = '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏';
                    details = '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É';
                } else {
                    details = error.message;
                }
                
                this.showError(userMessage, details, true);
                this.showNotification(userMessage, 'error');
            }

            downloadResults(format = 'txt') {
                if (this.results.length === 0) {
                    this.showNotification('–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è', 'warning');
                    return;
                }

                let content, filename, mimeType;
                
                switch(format) {
                    case 'apa':
                        content = this.formatResultsForAPA();
                        filename = `scopus-results-apa-${new Date().toISOString().split('T')[0]}.txt`;
                        mimeType = 'text/plain;charset=utf-8';
                        break;
                    case 'gost':
                        content = this.formatResultsForGOST();
                        filename = `scopus-results-gost-${new Date().toISOString().split('T')[0]}.txt`;
                        mimeType = 'text/plain;charset=utf-8';
                        break;
                    case 'json':
                        content = this.formatResultsForJSON();
                        filename = `scopus-results-${new Date().toISOString().split('T')[0]}.json`;
                        mimeType = 'application/json;charset=utf-8';
                        break;
                    case 'excel':
                        this.downloadExcel();
                        return;
                    default:
                        content = this.formatResultsForExport();
                        filename = `scopus-results-${new Date().toISOString().split('T')[0]}.txt`;
                        mimeType = 'text/plain;charset=utf-8';
                }

                const blob = new Blob([content], { type: mimeType });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.showNotification(`–§–∞–π–ª ${filename} —Å–∫–∞—á–∞–Ω`, 'success');
            }

            copyResults() {
                if (this.results.length === 0) {
                    alert('–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è');
                    return;
                }

                const text = this.formatResultsForExport();
                navigator.clipboard.writeText(text).then(() => {
                    alert('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
                }).catch(err => {
                    console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ', err);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª.');
                });
            }

            formatResultsForExport() {
                const query = document.getElementById('scopusQuery').value;
                const searchType = document.querySelector('input[name="searchType"]:checked').value;
                const startYear = document.getElementById('scopusStartYear').value;
                const endYear = document.getElementById('scopusEndYear').value;
                
                let text = `–†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–û–ò–°–ö–ê –í SCOPUS\n`;
                text += `–ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å: ${query} (${searchType === 'author' ? 'ID –∞–≤—Ç–æ—Ä–∞' : searchType === 'affiliation' ? '–ê—Ñ—Ñ–∏–ª–∏–∞—Ü–∏—è' : '–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞'})\n`;
                if (startYear || endYear) {
                    text += `–ü–µ—Ä–∏–æ–¥: ${startYear || '–Ω–µ —É–∫–∞–∑–∞–Ω'} - ${endYear || '–Ω–µ —É–∫–∞–∑–∞–Ω'}\n`;
                }
                text += `–î–∞—Ç–∞ –ø–æ–∏—Å–∫–∞: ${new Date().toLocaleString('ru-RU')}\n`;
                text += `–ù–∞–π–¥–µ–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: ${this.results.length}\n\n`;
                text += `========================================\n\n`;

                this.results.forEach((work, index) => {
                    const title = work.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
                    const authors = work.authors || '–ê–≤—Ç–æ—Ä—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã';
                    const journal = work.journal || '–ñ—É—Ä–Ω–∞–ª –Ω–µ —É–∫–∞–∑–∞–Ω';
                    const year = work.year || '–ì–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω';
                    const doi = work.doi || '';
                    const citations = work.citations || 0;

                    text += `${index + 1}. ${title}\n`;
                    text += `–ê–≤—Ç–æ—Ä—ã: ${authors}\n`;
                    text += `–ñ—É—Ä–Ω–∞–ª: ${journal}\n`;
                    text += `–ì–æ–¥: ${year}\n`;
                    text += `–¶–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ${citations}\n`;
                    text += `DOI: ${doi}\n\n`;
                });

                return text;
            }

            formatResultsForAPA() {
                const query = document.getElementById('scopusQuery').value;
                const searchType = document.querySelector('input[name="searchType"]:checked').value;
                const startYear = document.getElementById('scopusStartYear').value;
                const endYear = document.getElementById('scopusEndYear').value;
                
                let text = `REFERENCES (APA FORMAT)\n`;
                text += `Search query: ${query} (${searchType === 'author' ? 'Author ID' : searchType === 'affiliation' ? 'Affiliation' : 'Keywords'})\n`;
                if (startYear || endYear) {
                    text += `Publication period: ${startYear || 'not specified'} - ${endYear || 'not specified'}\n`;
                }
                text += `Search date: ${new Date().toLocaleString('en-US')}\n`;
                text += `Total results: ${this.results.length}\n\n`;

                this.results.forEach((work, index) => {
                    const title = work.title || 'Untitled';
                    const year = work.year || 'n.d.';
                    const doi = work.doi || '';
                    const volume = work.volume || '';
                    const issue = work.issue || '';
                    const pages = work.pages || '';

                    // Format authors in APA style
                    const authorString = this.formatScopusAuthorsForAPA(work.authors);

                    // Format journal info
                    const journal = work.journal || 'Unknown Journal';
                    let journalInfo = journal;
                    if (volume) {
                        journalInfo += `, ${volume}`;
                        if (issue) {
                            journalInfo += `(${issue})`;
                        }
                        if (pages) {
                            journalInfo += `, ${pages}`;
                        }
                    }

                    // Construct APA reference
                    text += `${authorString} (${year}). ${title}. ${journalInfo}`;
                    if (doi) {
                        text += `. https://doi.org/${doi}`;
                    }
                    text += '.\n\n';
                });

                return text;
            }

            formatScopusAuthorsForAPA(authorsString) {
                if (!authorsString || authorsString === '–ê–≤—Ç–æ—Ä—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã') return 'Anonymous';
                
                // –†–∞–∑–±–∏–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É –∞–≤—Ç–æ—Ä–æ–≤ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∞–≤—Ç–æ—Ä–æ–≤
                // –§–æ—Ä–º–∞—Ç: "–§–∞–º–∏–ª–∏—è1, –ò–º—è1 | –§–∞–º–∏–ª–∏—è2, –ò–º—è2"
                const authors = authorsString.split(' | ');
                
                if (authors.length === 0) return 'Anonymous';
                
                if (authors.length === 1) {
                    const [surname, givenName] = authors[0].split(', ');
                    return `${surname}, ${givenName.charAt(0).toUpperCase()}.`;
                } else if (authors.length <= 7) {
                    return authors.map(author => {
                        const [surname, givenName] = author.split(', ');
                        return `${surname}, ${givenName.charAt(0).toUpperCase()}.`;
                    }).join(', ');
                } else {
                    const [surname, givenName] = authors[0].split(', ');
                    return `${surname}, ${givenName.charAt(0).toUpperCase()}., et al.`;
                }
            }

            formatResultsForGOST() {
                const query = document.getElementById('scopusQuery').value;
                const searchType = document.querySelector('input[name="searchType"]:checked').value;
                const startYear = document.getElementById('scopusStartYear').value;
                const endYear = document.getElementById('scopusEndYear').value;
                
                let text = `–°–ü–ò–°–û–ö –õ–ò–¢–ï–†–ê–¢–£–†–´ (–ì–û–°–¢ 7.1-2003)\n`;
                text += `–ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å: ${query} (${searchType === 'author' ? 'ID –∞–≤—Ç–æ—Ä–∞' : searchType === 'affiliation' ? '–ê—Ñ—Ñ–∏–ª–∏–∞—Ü–∏—è' : '–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞'})\n`;
                if (startYear || endYear) {
                    text += `–ü–µ—Ä–∏–æ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏: ${startYear || '–Ω–µ —É–∫–∞–∑–∞–Ω'} - ${endYear || '–Ω–µ —É–∫–∞–∑–∞–Ω'}\n`;
                }
                text += `–î–∞—Ç–∞ –ø–æ–∏—Å–∫–∞: ${new Date().toLocaleString('ru-RU')}\n`;
                text += `–í—Å–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: ${this.results.length}\n\n`;

                this.results.forEach((work, index) => {
                    const title = work.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
                    const year = work.year || '–±.–≥.';
                    const doi = work.doi || '';
                    const volume = work.volume || '';
                    const issue = work.issue || '';
                    const pages = work.pages || '';

                    // Format authors in GOST style
                    const authorString = this.formatScopusAuthorsForGOST(work.authors);

                    // Format journal info
                    const journal = work.journal || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∂—É—Ä–Ω–∞–ª';
                    let journalInfo = journal;
                    if (volume) {
                        journalInfo += `. ‚Äì ${year}. ‚Äì –¢. ${volume}`;
                        if (issue) {
                            journalInfo += `, ‚Ññ ${issue}`;
                        }
                        if (pages) {
                            journalInfo += `. ‚Äì –°. ${pages}`;
                        }
                    } else {
                        journalInfo += `. ‚Äì ${year}`;
                    }

                    // Construct GOST reference
                    text += `${authorString} ${title} // ${journalInfo}`;
                    if (doi) {
                        text += `. ‚Äì DOI: ${doi}`;
                    }
                    text += '.\n\n';
                });

                return text;
            }

            formatScopusAuthorsForGOST(authorsString) {
                if (!authorsString || authorsString === '–ê–≤—Ç–æ—Ä—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã') return '–ê–Ω–æ–Ω–∏–º';
                
                // –†–∞–∑–±–∏–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É –∞–≤—Ç–æ—Ä–æ–≤ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∞–≤—Ç–æ—Ä–æ–≤
                // –§–æ—Ä–º–∞—Ç: "–§–∞–º–∏–ª–∏—è1, –ò–º—è1 | –§–∞–º–∏–ª–∏—è2, –ò–º—è2"
                const authors = authorsString.split(' | ');
                
                if (authors.length === 0) return '–ê–Ω–æ–Ω–∏–º';
                
                if (authors.length === 1) {
                    return authors[0].replace(', ', ' ');
                } else if (authors.length <= 3) {
                    return authors.map(author => author.replace(', ', ' ')).join(', ');
                } else {
                    return `${authors[0].replace(', ', ' ')} [–∏ –¥—Ä.]`;
                }
            }

            formatResultsForJSON() {
                const query = document.getElementById('scopusQuery').value;
                const searchType = document.querySelector('input[name="searchType"]:checked').value;
                const startYear = document.getElementById('scopusStartYear').value;
                const endYear = document.getElementById('scopusEndYear').value;
                
                const exportData = {
                    metadata: {
                        searchQuery: query,
                        searchType: searchType,
                        startYear: startYear || null,
                        endYear: endYear || null,
                        exportDate: new Date().toISOString(),
                        totalResults: this.results.length,
                        source: 'Scopus API'
                    },
                    publications: this.results.map((work, index) => ({
                        id: index + 1,
                        title: work.title,
                        authors: work.authors,
                        journal: work.journal,
                        year: work.year,
                        abstract: work.abstract,
                        doi: work.doi,
                        url: work.url,
                        citations: work.citations,
                        volume: work.volume,
                        issue: work.issue,
                        pages: work.pages,
                        source: work.source
                    }))
                };
                
                return JSON.stringify(exportData, null, 2);
            }

            downloadExcel() {
                // –°–æ–∑–¥–∞–µ–º CSV —Ñ–∞–π–ª (–ø—Ä–æ—Å—Ç–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ Excel)
                const csvContent = this.formatResultsForCSV();
                const filename = `scopus-results-${new Date().toISOString().split('T')[0]}.csv`;
                
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.showNotification(`–§–∞–π–ª ${filename} —Å–∫–∞—á–∞–Ω`, 'success');
            }

            formatResultsForCSV() {
                const headers = ['‚Ññ', '–ù–∞–∑–≤–∞–Ω–∏–µ', '–ê–≤—Ç–æ—Ä—ã', '–ñ—É—Ä–Ω–∞–ª', '–ì–æ–¥', '–¶–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', 'DOI', 'URL'];
                const rows = this.results.map((work, index) => [
                    index + 1,
                    `"${work.title.replace(/"/g, '""')}"`,
                    `"${work.authors.replace(/"/g, '""')}"`,
                    `"${work.journal.replace(/"/g, '""')}"`,
                    work.year,
                    work.citations,
                    work.doi,
                    work.url
                ]);
                
                return [headers.join(','), ...rows.map(row => row.join(','))].join('\n');
            }

            // –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫—ç—à–µ–º
            loadCachedData() {
                try {
                    const cachedResults = localStorage.getItem('scopus_search_results');
                    
                    if (cachedResults) {
                        const searchData = JSON.parse(cachedResults);
                        const cacheTime = new Date(searchData.cacheTime);
                        const now = new Date();
                        const hoursDiff = (now - cacheTime) / (1000 * 60 * 60);
                        
                        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à –µ—Å–ª–∏ –æ–Ω –Ω–µ —Å—Ç–∞—Ä—à–µ 2 —á–∞—Å–æ–≤
                        if (hoursDiff < 2) {
                            this.results = searchData.data;
                            this.displayResults(searchData.data);
                            this.showNotification('–ó–∞–≥—Ä—É–∂–µ–Ω—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞', 'success');
                        }
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', error);
                }
            }

            saveToCache(key, data) {
                try {
                    const cacheData = {
                        data: data,
                        cacheTime: new Date().toISOString()
                    };
                    localStorage.setItem(key, JSON.stringify(cacheData));
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –∫—ç—à:', error);
                }
            }

            clearCache() {
                try {
                    const keys = Object.keys(localStorage);
                    keys.forEach(key => {
                        if (key.startsWith('scopus_')) {
                            localStorage.removeItem(key);
                        }
                    });
                    this.showNotification('–ö—ç—à –æ—á–∏—â–µ–Ω', 'success');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞:', error);
                }
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let searcher;
        document.addEventListener('DOMContentLoaded', () => {
            searcher = new ScopusSearcher();
        });
    </script>
</body>
</html>
